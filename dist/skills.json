[
  {
    "id": "createChartAction",
    "name": "Action createChart",
    "description": "Specification de l'action JSON pour creer un graphique dans le builder-IA",
    "trigger": [
      "createchart",
      "creer un graphique",
      "apercu",
      "preview"
    ],
    "content": "## Action createChart (builder-IA uniquement)\n\nCette action genere un graphique interactif dans l'apercu du builder-IA.\nElle est distincte du code embarquable HTML (voir skills composants gouv-widgets).\n\n### Format\n```json\n{\n  \"action\": \"createChart\",\n  \"config\": {\n    \"type\": \"bar\",\n    \"labelField\": \"nom_region\",\n    \"valueField\": \"population\",\n    \"aggregation\": \"sum\",\n    \"where\": \"status:eq:active\",\n    \"limit\": 10,\n    \"sortOrder\": \"desc\",\n    \"title\": \"Titre du graphique\",\n    \"subtitle\": \"Sous-titre\",\n    \"color\": \"#000091\",\n    \"palette\": \"categorical\"\n  }\n}\n```\n\n### Proprietes de config\n| Propriete | Type | Requis | Description |\n|-----------|------|--------|-------------|\n| type | String | oui | Type de visualisation (voir ci-dessous) |\n| labelField | String | selon type | Champ pour les labels / axe X |\n| valueField | String | oui | Champ pour les valeurs / axe Y |\n| valueField2 | String | non | 2e serie (bar-line, comparaisons) |\n| codeField | String | non | Champ code departement/region (map, map-reg) |\n| aggregation | String | non | Fonction : sum, avg, count, min, max |\n| where | String | non | Filtre pre-agregation (voir syntaxe ci-dessous) |\n| limit | Number | non | Nombre max de resultats |\n| sortOrder | String | non | Tri : \"asc\" ou \"desc\" |\n| title | String | non | Titre affiche |\n| subtitle | String | non | Sous-titre affiche |\n| color | String | non | Couleur primaire hex (defaut: #000091) |\n| color2 | String | non | Couleur secondaire hex (bar-line) |\n| variant | String | non | Style KPI : info, success, warning, error |\n| unit | String | non | Unite affichee : EUR, %, ou texte libre |\n| palette | String | non | Palette DSFR : categorical, sequentialAscending, sequentialDescending, divergentAscending, divergentDescending, neutral. Fonctionne pour tous les types de graphiques. |\n| colonnes | String | non | Colonnes datalist : \"champ:Label, champ2:Label2\" |\n| pagination | Number | non | Lignes par page (datalist) |\n\n### Types valides et champs requis\n| Type | labelField | valueField | Cas d'usage |\n|------|-----------|------------|-------------|\n| bar | oui | oui | Comparer des categories (5-15) |\n| line | oui | oui | Evolution temporelle, tendances |\n| pie | oui | oui | Parts d'un tout (max 5-7 segments) |\n| radar | oui | oui | Profils multicriteres |\n| scatter | oui | oui | Correlation entre 2 variables numeriques |\n| bar-line | oui | oui (+valueField2) | 2 metriques : barres + ligne |\n| gauge | non | oui | Progression 0-100% |\n| kpi | non | oui | Indicateur chiffre cle unique |\n| map | non (codeField) | oui | Donnees par departement francais |\n| map-reg | non (codeField) | oui | Donnees par region francaise |\n| datalist | non | non (colonnes) | Tableau de donnees filtrable |\n\nIMPORTANT :\n- `doughnut` = `pie` (le composant pie est un anneau par defaut)\n- `horizontalBar` = `bar` (le renderer le convertit automatiquement)\n- Pour KPI et gauge : PAS de labelField\n- Pour map/map-reg : utiliser codeField (pas labelField)\n\n### Syntaxe du filtre (config.where)\nFormat : `\"champ:operateur:valeur\"`\nMultiples filtres : virgule = ET logique `\"champ1:op:val, champ2:op:val\"`\nOperateurs : eq, neq, gt, gte, lt, lte, contains, in (separateur |)\nLe filtre s'applique AVANT l'agregation. Utiliser les noms de champs bruts de la source.\n\n### Exemples\n```json\n{\"action\":\"createChart\",\"config\":{\"type\":\"kpi\",\"valueField\":\"prix\",\"aggregation\":\"avg\",\"where\":\"code_departement:eq:48\",\"title\":\"Prix moyen dept 48\",\"unit\":\"EUR\"}}\n```\n```json\n{\"action\":\"createChart\",\"config\":{\"type\":\"bar\",\"labelField\":\"region\",\"valueField\":\"population\",\"aggregation\":\"sum\",\"limit\":5,\"sortOrder\":\"desc\",\"title\":\"Top 5 regions\"}}\n```\n```json\n{\"action\":\"createChart\",\"config\":{\"type\":\"map\",\"codeField\":\"code_dept\",\"valueField\":\"score\",\"palette\":\"sequentialAscending\",\"title\":\"Score par departement\"}}\n```\n```json\n{\"action\":\"createChart\",\"config\":{\"type\":\"datalist\",\"colonnes\":\"nom:Nom, email:Email, ville:Ville\",\"pagination\":20,\"title\":\"Liste des contacts\"}}\n```\n```json\n{\"action\":\"createChart\",\"config\":{\"type\":\"pie\",\"labelField\":\"region\",\"valueField\":\"population\",\"aggregation\":\"sum\",\"palette\":\"divergentAscending\",\"title\":\"Population par region\"}}\n```\n\nGenere TOUJOURS UN SEUL bloc JSON par reponse. Pour changer la couleur ou palette d'un graphique existant, regenere le meme createChart avec la palette souhaitee."
  },
  {
    "id": "reloadDataAction",
    "name": "Action reloadData",
    "description": "Recharger les donnees de la source avec des parametres ODSQL",
    "trigger": [
      "recharger",
      "reloaddata",
      "nouveaux parametres",
      "refiltrer"
    ],
    "content": "## Action reloadData (builder-IA uniquement)\n\nRecharge les donnees depuis l'API source avec de nouveaux parametres ODSQL.\nUtile quand l'utilisateur veut modifier le jeu de donnees avant de creer un graphique.\n\n### Format\n```json\n{\n  \"action\": \"reloadData\",\n  \"query\": {\n    \"where\": \"condition ODSQL\",\n    \"select\": \"champs a selectionner\",\n    \"group_by\": \"champ de groupement\",\n    \"order_by\": \"champ ASC|DESC\",\n    \"limit\": 100\n  },\n  \"reason\": \"Explication pour l'utilisateur\"\n}\n```\n\n### Proprietes de query\n| Propriete | Type | Description |\n|-----------|------|-------------|\n| select | String | Champs a retourner, avec aliases : `\"region, avg(prix) as prix_moyen\"` |\n| where | String | Filtre ODSQL : `\"population > 10000\"` ou `\"nom like 'Paris%'\"` |\n| group_by | String | Groupement : `\"region\"` |\n| order_by | String | Tri : `\"population DESC\"` |\n| limit | Number | Nombre max de resultats (defaut API : 10, max : 100 par requete) |\n\n### Exemples\n```json\n{\"action\":\"reloadData\",\"query\":{\"order_by\":\"valeur DESC\",\"limit\":10},\"reason\":\"Top 10 par valeur\"}\n```\n```json\n{\"action\":\"reloadData\",\"query\":{\"where\":\"prix > 50\",\"select\":\"region, avg(prix) as prix_moyen\",\"group_by\":\"region\"},\"reason\":\"Prix moyen par region (> 50)\"}\n```\n\nIMPORTANT : la syntaxe `query` est de l'ODSQL (operateurs SQL), a ne pas confondre\navec la syntaxe `config.where` de createChart qui utilise le format \"champ:operateur:valeur\"."
  },
  {
    "id": "gouvSource",
    "name": "gouv-source",
    "description": "Composant de connexion aux donnees (API REST)",
    "trigger": [
      "source",
      "charger",
      "connecter",
      "rafraichir",
      "url",
      "api",
      "donnees"
    ],
    "content": "## <gouv-source> - Connexion aux donnees\n\nComposant invisible qui recupere des donnees depuis une API REST et les distribue\naux autres composants via un systeme de bus evenementiel (data-bridge).\n\n### Format des donnees\ngouv-source attend une reponse JSON. L'attribut `transform` permet d'extraire le\ntableau de donnees depuis la reponse. Le resultat DOIT etre un tableau d'objets plats :\n`[{\"region\": \"IDF\", \"population\": 12000000}, {\"region\": \"OCC\", \"population\": 6000000}]`\n\n### Attributs\n| Attribut | Type | Defaut | Requis | Description |\n|----------|------|--------|--------|-------------|\n| id | String | - | oui | Identifiant unique. Les autres composants s'y abonnent via `source=\"cet-id\"`. |\n| url | String | `\"\"` | oui | URL de l'API (GET par defaut) |\n| method | String | `\"GET\"` | non | Methode HTTP : GET ou POST |\n| headers | String | `\"\"` | non | En-tetes HTTP en JSON : `'{\"Authorization\": \"Bearer xxx\"}'` |\n| params | String | `\"\"` | non | Parametres query (GET) ou body (POST) en JSON |\n| transform | String | `\"\"` | non | Chemin JSONPath vers les donnees : `\"results\"`, `\"data.items\"`, `\"records\"` |\n| refresh | Number | `0` | non | Rafraichissement auto en secondes (0 = desactive) |\n\n### Evenements emis\n- `gouv-data-loaded` : donnees chargees (detail : tableau de donnees)\n- `gouv-data-loading` : chargement en cours\n- `gouv-data-error` : erreur (detail : objet Error)\n\n### Methodes publiques\n- `reload()` : force le rechargement des donnees\n- `getData()` : retourne les donnees actuelles (tableau d'objets)\n\n### Exemples\n```html\n<!-- API OpenDataSoft v2.1 -->\n<gouv-source id=\"prix\"\n  url=\"https://data.economie.gouv.fr/api/explore/v2.1/catalog/datasets/mon-dataset/records\"\n  transform=\"results\">\n</gouv-source>\n\n<!-- API avec authentification et refresh toutes les 60s -->\n<gouv-source id=\"api-privee\"\n  url=\"https://mon-api.gouv.fr/data\"\n  method=\"POST\"\n  headers='{\"Authorization\": \"Bearer TOKEN\"}'\n  params='{\"limit\": 100}'\n  transform=\"data.items\"\n  refresh=\"60\">\n</gouv-source>\n\n<!-- API Tabular data.gouv.fr -->\n<gouv-source id=\"communes\"\n  url=\"https://tabular-api.data.gouv.fr/api/resources/RESOURCE_ID/data/?page_size=50\"\n  transform=\"data\">\n</gouv-source>\n```\n\n> **Note** : les APIs Grist et ODS v1 renvoient des donnees imbriquees sous `fields`.\n> Utilisez `<gouv-normalize flatten=\"fields\">` pour les aplatir avant de les passer\n> aux facettes, datalist ou graphiques. Voir la doc de gouv-normalize."
  },
  {
    "id": "gouvQuery",
    "name": "gouv-query",
    "description": "Filtrage, agregation et tri declaratif des donnees",
    "trigger": [
      "filtre",
      "filtrer",
      "grouper",
      "agreger",
      "trier",
      "transformer",
      "query",
      "requete",
      "top",
      "moyenne",
      "somme",
      "compter",
      "seulement",
      "uniquement",
      "plus de",
      "moins de",
      "departement",
      "region",
      "dans le",
      "pour le"
    ],
    "content": "## <gouv-query> - Transformation de donnees\n\nComposant invisible intermediaire entre <gouv-source> et les visualisations.\nFiltre, groupe, agrege et trie les donnees de facon declarative.\nPeut s'enchainer : un gouv-query peut etre la source d'un autre gouv-query.\n\n### Format des donnees\nEntree : tableau d'objets plats (fourni par gouv-source ou un autre gouv-query).\nSortie : tableau d'objets plats, transforme selon les attributs.\nApres agregation, les champs sont nommes automatiquement : `champ__fonction`\n(ex: `population__sum`, `prix__avg`).\n\n### 3 modes (attribut api-type)\n| Mode | Description | Source des donnees |\n|------|-------------|-------------------|\n| generic (defaut) | Traitement client-side | Attribut `source` -> ID d'une gouv-source ou gouv-query |\n| opendatasoft | Requete serveur ODSQL | Attributs `base-url` + `dataset-id` |\n| tabular | Requete serveur Tabular API | Attributs `base-url` + `resource` |\n\n### Attributs\n| Attribut | Type | Defaut | Requis | Description |\n|----------|------|--------|--------|-------------|\n| id | String | - | oui | Identifiant unique |\n| api-type | String | `\"generic\"` | non | Mode : generic, opendatasoft, tabular |\n| source | String | `\"\"` | mode generic | ID de la gouv-source ou gouv-query parente |\n| base-url | String | `\"\"` | mode ods/tabular | URL de base de l'API |\n| dataset-id | String | `\"\"` | mode ods | Identifiant du dataset OpenDataSoft |\n| resource | String | `\"\"` | mode tabular | Identifiant de la ressource Tabular |\n| select | String | `\"\"` | non | Clause SELECT ODSQL (mode opendatasoft) |\n| where | String | `\"\"` | non | Filtres (voir syntaxe ci-dessous) |\n| filter | String | `\"\"` | non | Alias de where (compatibilite) |\n| group-by | String | `\"\"` | non | Champs de groupement (separes par virgule) |\n| aggregate | String | `\"\"` | non | Agregations : `\"champ:fonction\"` ou `\"champ:fonction:alias\"` |\n| order-by | String | `\"\"` | non | Tri : `\"champ:asc\"` ou `\"champ:desc\"` |\n| limit | Number | `0` | non | Limite de resultats (0 = illimite) |\n| transform | String | `\"\"` | non | Chemin JSONPath dans la reponse API |\n| refresh | Number | `0` | non | Rafraichissement en secondes (0 = desactive) |\n\n### Operateurs de filtre (mode generic/tabular)\nFormat : `\"champ:operateur:valeur\"`\nMultiples filtres separes par virgule (logique ET) :\n`where=\"population:gte:10000, region:in:IDF|OCC\"`\n\n| Operateur | Description | Exemple |\n|-----------|-------------|---------|\n| eq | Egal | `\"status:eq:active\"` |\n| neq | Different | `\"type:neq:brouillon\"` |\n| gt | Strictement superieur | `\"prix:gt:100\"` |\n| gte | Superieur ou egal | `\"population:gte:10000\"` |\n| lt | Strictement inferieur | `\"score:lt:50\"` |\n| lte | Inferieur ou egal | `\"age:lte:30\"` |\n| contains | Contient (insensible a la casse) | `\"nom:contains:paris\"` |\n| notcontains | Ne contient pas | `\"email:notcontains:spam\"` |\n| in | Dans la liste (separateur \\|) | `\"region:in:IDF\\|OCC\\|BRE\"` |\n| notin | Pas dans la liste | `\"status:notin:archive\\|supprime\"` |\n| isnull | Est vide/null | `\"email:isnull\"` |\n| isnotnull | N'est pas vide | `\"telephone:isnotnull\"` |\n\n### Fonctions d'agregation\nFormat : `\"champ:fonction\"` ou `\"champ:fonction:alias\"`\nNommage automatique sans alias : `champ__fonction` (ex: `population__sum`)\n\n| Fonction | Description | Exemple |\n|----------|-------------|---------|\n| count | Nombre d'elements | `\"id:count\"` |\n| sum | Somme | `\"montant:sum\"` |\n| avg | Moyenne | `\"prix:avg\"` |\n| min | Minimum | `\"temperature:min\"` |\n| max | Maximum | `\"score:max\"` |\n\n### Exemples\n```html\n<!-- Mode generic : filtrer et trier -->\n<gouv-query id=\"filtered\" source=\"raw-data\"\n  where=\"population:gt:5000\"\n  order-by=\"nom:asc\"\n  limit=\"10\">\n</gouv-query>\n\n<!-- Mode generic : grouper et agreger -->\n<gouv-query id=\"stats\" source=\"communes\"\n  group-by=\"region\"\n  aggregate=\"population:sum, population:count\"\n  order-by=\"population__sum:desc\"\n  limit=\"10\">\n</gouv-query>\n\n<!-- Mode opendatasoft : requete serveur ODSQL -->\n<gouv-query id=\"ods\" api-type=\"opendatasoft\"\n  dataset-id=\"mon-dataset\"\n  base-url=\"https://data.opendatasoft.com\"\n  select=\"sum(population) as total, region\"\n  where=\"population > 5000\"\n  group-by=\"region\"\n  order-by=\"total:desc\"\n  limit=\"15\">\n</gouv-query>\n\n<!-- Mode tabular : requete serveur data.gouv.fr -->\n<gouv-query id=\"tab\" api-type=\"tabular\"\n  resource=\"RESOURCE_ID\"\n  group-by=\"departement\"\n  aggregate=\"population:sum\"\n  order-by=\"population__sum:desc\">\n</gouv-query>\n\n<!-- Chainabilite : un query comme source d'un autre -->\n<gouv-query id=\"actifs\" source=\"raw\" where=\"status:eq:active\"></gouv-query>\n<gouv-query id=\"top5\" source=\"actifs\" group-by=\"region\" aggregate=\"montant:sum\" order-by=\"montant__sum:desc\" limit=\"5\"></gouv-query>\n```"
  },
  {
    "id": "gouvNormalize",
    "name": "gouv-normalize",
    "description": "Nettoyage et normalisation des donnees avant traitement",
    "trigger": [
      "normaliser",
      "nettoyer",
      "renommer",
      "convertir",
      "normalize",
      "clean",
      "nettoyage",
      "normalisation",
      "grist",
      "airtable",
      "flatten",
      "aplatir",
      "nested",
      "ods v1",
      "records.fields"
    ],
    "content": "## <gouv-normalize> - Normalisation de donnees\n\nComposant invisible intermediaire qui nettoie et normalise les donnees avant traitement.\nSe place entre <gouv-source> et <gouv-query> (ou directement avant une visualisation).\n\n### Position recommandee\n```\ngouv-source -> gouv-normalize -> gouv-query -> gouv-dsfr-chart\n```\nNormaliser AVANT gouv-query permet aux filtres et agregations de travailler sur des donnees propres\n(evite les comparaisons string vs number).\n\n### Format des donnees\nEntree : tableau d'objets (fourni par gouv-source ou un autre composant).\nSortie : meme tableau avec valeurs nettoyees/renommees.\n\n### Attributs\n| Attribut | Type | Defaut | Requis | Description |\n|----------|------|--------|--------|-------------|\n| source | String | `\"\"` | oui | ID de la source a ecouter |\n| flatten | String | `\"\"` | non | Cle du sous-objet a extraire au premier niveau. Utilise pour les APIs Grist, ODS v1, Airtable qui wrappent les donnees sous `fields`. Supporte la dot notation (`data.attributes`). |\n| numeric | String | `\"\"` | non | Champs a forcer en nombre (virgule-separes) : `\"population, surface\"` |\n| numeric-auto | Boolean | `false` | non | Detection et conversion auto des champs numeriques |\n| rename | String | `\"\"` | non | Renommage : `\"ancien:nouveau | ancien2:nouveau2\"` (pipe-separe) |\n| trim | Boolean | `false` | non | Supprime les espaces en debut/fin des cles ET valeurs string |\n| strip-html | Boolean | `false` | non | Supprime les balises HTML des valeurs string |\n| replace | String | `\"\"` | non | Remplace des valeurs : `\"N/A: | n.d.: | -:0\"` (pipe-separe) |\n| lowercase-keys | Boolean | `false` | non | Met toutes les cles en minuscules |\n\n### Ordre d'execution des transformations\n1. **flatten** — aplatit le sous-objet designe\n2. rename — renomme les cles\n3. replace — remplace les valeurs\n4. trim — nettoie les espaces\n5. strip-html — supprime le HTML\n6. numeric / numeric-auto — conversion en nombres\n7. lowercase-keys — cles en minuscules\n\n### Separateurs\n- `numeric` : champs separes par virgule\n- `rename` et `replace` : paires separees par `|`, cle et valeur separees par `:`\n  Le `:` separe le pattern de sa valeur de remplacement (valeur vide = suppression).\n\n### Aplatir des donnees imbriquees (Grist, ODS v1, Airtable)\n\nCertaines APIs renvoient chaque enregistrement sous la forme `{id, fields: {…}}`.\nL'attribut `flatten` extrait les cles du sous-objet et les remonte au premier niveau,\nrendant les donnees compatibles avec tous les composants (facettes, datalist, graphiques, KPI).\n\n```html\n<!-- Grist -->\n<gouv-source id=\"raw\"\n  url=\"https://grist.example.com/api/docs/XXX/tables/MaTable/records\"\n  transform=\"records\">\n</gouv-source>\n<gouv-normalize id=\"clean\" source=\"raw\" flatten=\"fields\" trim numeric-auto></gouv-normalize>\n\n<!-- ODS v1 (legacy) -->\n<gouv-source id=\"raw-v1\"\n  url=\"https://data.gouv.fr/api/records/1.0/search/?dataset=mon-dataset&rows=100\"\n  transform=\"records\">\n</gouv-source>\n<gouv-normalize id=\"clean-v1\" source=\"raw-v1\" flatten=\"fields\" trim></gouv-normalize>\n\n<!-- Airtable -->\n<gouv-source id=\"airtable\"\n  url=\"https://api.airtable.com/v0/appXXX/Table\"\n  headers='{\"Authorization\": \"Bearer pat...\"}'\n  transform=\"records\">\n</gouv-source>\n<gouv-normalize id=\"clean-at\" source=\"airtable\" flatten=\"fields\" trim></gouv-normalize>\n```\n\n### Exemples\n```html\n<!-- Conversion numerique + renommage -->\n<gouv-source id=\"raw\" url=\"https://api.fr/data\" transform=\"results\"></gouv-source>\n<gouv-normalize id=\"clean\" source=\"raw\"\n  numeric=\"population, budget\"\n  rename=\"pop_tot:Population totale | lib_dep:Departement\"\n  trim>\n</gouv-normalize>\n<gouv-query id=\"stats\" source=\"clean\" group-by=\"Departement\" aggregate=\"population:sum\"></gouv-query>\n<gouv-dsfr-chart source=\"stats\" type=\"bar\" label-field=\"Departement\" value-field=\"population__sum\"></gouv-dsfr-chart>\n\n<!-- Grist : aplatir + nettoyer + forcer les types numeriques -->\n<gouv-normalize id=\"clean\" source=\"raw\"\n  flatten=\"fields\"\n  trim\n  numeric=\"Montant_de_la_sanction_\"\n  rename=\"Montant_de_la_sanction_:Montant | Nom_de_l_entreprise:Entreprise\">\n</gouv-normalize>\n\n<!-- Nettoyage complet : trim + strip HTML + remplacement de valeurs vides -->\n<gouv-normalize id=\"propre\" source=\"raw\"\n  trim\n  strip-html\n  replace=\"N/A: | n.d.: | -:0\"\n  numeric-auto>\n</gouv-normalize>\n\n<!-- Normalisation des cles en minuscules -->\n<gouv-normalize id=\"lower\" source=\"raw\" lowercase-keys></gouv-normalize>\n```"
  },
  {
    "id": "gouvFacets",
    "name": "gouv-facets",
    "description": "Filtres a facettes interactifs pour exploration de donnees",
    "trigger": [
      "facette",
      "facets",
      "filtre interactif",
      "categorie",
      "refinement",
      "exploration",
      "filtrer par"
    ],
    "content": "## <gouv-facets> - Filtres a facettes\n\nComposant visuel intermediaire qui affiche des filtres interactifs (checkboxes) bases sur les valeurs\ncategoriques des donnees. Se place entre une source/normalize/query et les composants de visualisation.\n\n### Position dans le pipeline\n```\ngouv-source -> gouv-normalize -> gouv-facets -> gouv-dsfr-chart / gouv-datalist\n```\nLes donnees filtrees sont redistribuees automatiquement aux composants en aval.\n\n### Format des donnees\nEntree : tableau d'objets (fourni par gouv-source, gouv-normalize ou gouv-query).\nSortie : meme tableau, filtre selon les selections de l'utilisateur.\n\n### Attributs\n| Attribut | Type | Defaut | Requis | Description |\n|----------|------|--------|--------|-------------|\n| source | String | `\"\"` | oui | ID de la source a ecouter |\n| fields | String | `\"\"` | non | Champs a exposer comme facettes (virgule-separes). Vide = auto-detection |\n| labels | String | `\"\"` | non | Labels custom : `\"field:Label | field2:Label 2\"` (pipe-separe) |\n| max-values | Number | `6` | non | Nb de valeurs visibles par facette avant \"Voir plus\" |\n| disjunctive | String | `\"\"` | non | Champs en mode multi-selection OU (virgule-separes) |\n| sort | String | `\"count\"` | non | Tri des valeurs : count, -count, alpha, -alpha |\n| searchable | String | `\"\"` | non | Champs avec barre de recherche (virgule-separes) |\n| hide-empty | Boolean | `false` | non | Masquer les facettes avec une seule valeur |\n| display | String | `\"\"` | non | Mode d'affichage par facette : `\"field:select | field2:multiselect\"`. Modes : checkbox (defaut), select, multiselect |\n| url-params | Boolean | `false` | non | Active la lecture des parametres d'URL comme pre-selections de facettes |\n| url-param-map | String | `\"\"` | non | Mapping URL param -> champ : `\"r:region | t:type\"`. Si vide, correspondance directe |\n| url-sync | Boolean | `false` | non | Synchronise l'URL quand l'utilisateur change les facettes (replaceState) |\n\n### Modes d'affichage\n- **checkbox** (defaut) : checkboxes inline avec compteurs, \"Voir plus/moins\", recherche optionnelle\n- **select** : liste deroulante DSFR standard, selection exclusive (une seule valeur)\n- **multiselect** : dropdown custom avec checkboxes, recherche integree, bouton \"Tout deselectionner\"\n\nLe mode `select` rend la facette automatiquement exclusive.\nLe mode `multiselect` rend la facette automatiquement disjonctive (multi-selection OU).\n\n### Logique de filtrage\n- Intra-facette : OU (afficher les lignes qui matchent l'une des valeurs selectionnees)\n- Inter-facettes : ET (toutes les facettes doivent matcher)\n- Les compteurs se recalculent dynamiquement selon les selections\n\n### Auto-detection\nSi `fields` est omis, le composant detecte automatiquement les champs categoriques :\nchamps de type string avec 2 a 50 valeurs uniques (exclut les champs ID-like).\n\n### Exemples\n```html\n<!-- Facettes avec auto-detection -->\n<gouv-source id=\"raw\" url=\"https://api.fr/data\" transform=\"data\"></gouv-source>\n<gouv-normalize id=\"clean\" source=\"raw\" trim numeric-auto></gouv-normalize>\n<gouv-facets id=\"filtered\" source=\"clean\"></gouv-facets>\n<gouv-datalist source=\"filtered\"></gouv-datalist>\n\n<!-- Facettes explicites avec labels custom -->\n<gouv-facets id=\"filtered\" source=\"clean\"\n  fields=\"region, type_etablissement, statut\"\n  labels=\"region:Region | type_etablissement:Type | statut:Statut\"\n  searchable=\"region\"\n  max-values=\"10\">\n</gouv-facets>\n<gouv-dsfr-chart source=\"filtered\" type=\"bar\" label-field=\"region\" value-field=\"count\"></gouv-dsfr-chart>\n\n<!-- Modes d'affichage mixtes -->\n<gouv-facets id=\"filtered\" source=\"clean\"\n  fields=\"region, departement, statut\"\n  display=\"region:select | departement:multiselect\"\n  labels=\"region:Region | departement:Departement | statut:Statut\">\n</gouv-facets>\n\n<!-- Pre-selection via URL params (ex: ?region=PACA&type=Commune) -->\n<gouv-facets id=\"filtered\" source=\"clean\"\n  fields=\"region, type\" url-params>\n</gouv-facets>\n\n<!-- URL params avec mapping et synchronisation -->\n<gouv-facets id=\"filtered\" source=\"clean\"\n  fields=\"region, type\" url-params url-sync\n  url-param-map=\"r:region | t:type\">\n</gouv-facets>\n```"
  },
  {
    "id": "gouvSearch",
    "name": "gouv-search",
    "description": "Recherche textuelle avec champ DSFR, filtre les donnees en amont",
    "trigger": [
      "recherche",
      "search",
      "chercher",
      "filtrer texte",
      "barre de recherche",
      "full-text"
    ],
    "content": "## <gouv-search> - Recherche textuelle\n\nComposant visuel intermediaire qui affiche un champ de recherche DSFR et filtre\nles donnees avant de les redistribuer aux composants en aval. Se place entre\nune source/normalize et les facettes/visualisations.\n\n### Position dans le pipeline\n```\ngouv-source -> gouv-normalize -> gouv-search -> gouv-facets -> gouv-display\n```\nLa recherche reduit le jeu de donnees, les facettes affinent ensuite.\nLes compteurs de facettes se recalculent dynamiquement.\n\n### Attributs\n| Attribut | Type | Defaut | Requis | Description |\n|----------|------|--------|--------|-------------|\n| source | String | \"\" | oui | ID de la source a ecouter |\n| fields | String | \"\" | non | Champs a rechercher (virgule-separes). Vide = tous les champs |\n| placeholder | String | \"Rechercher...\" | non | Placeholder du champ |\n| label | String | \"Rechercher\" | non | Label accessible |\n| debounce | Number | 300 | non | Delai en ms avant filtrage |\n| min-length | Number | 0 | non | Nb minimum de caracteres |\n| highlight | Boolean | false | non | Ajoute _highlight avec <mark> pour gouv-display |\n| operator | String | \"contains\" | non | Mode : contains, starts, words |\n| sr-label | Boolean | false | non | Label en sr-only (masque visuellement) |\n| count | Boolean | false | non | Affiche compteur de resultats |\n| url-search-param | String | \"\" | non | Nom du parametre d'URL a lire comme terme de recherche initial |\n| url-sync | Boolean | false | non | Synchronise l'URL quand l'utilisateur tape (replaceState) |\n\n### Modes de recherche\n- **contains** (defaut) : sous-chaine insensible a la casse et aux accents\n- **starts** : chaque mot du champ doit commencer par le terme\n- **words** : tous les mots saisis doivent etre presents (dans n'importe quel champ)\n\n### Exemples\n```html\n<!-- Recherche simple -->\n<gouv-search id=\"searched\" source=\"clean\"\n  placeholder=\"Rechercher...\" count>\n</gouv-search>\n<gouv-display source=\"searched\" cols=\"2\" pagination=\"12\">\n  <template>...</template>\n</gouv-display>\n\n<!-- Recherche + facettes -->\n<gouv-search id=\"searched\" source=\"clean\"\n  fields=\"nom, description, code\"\n  operator=\"words\" count>\n</gouv-search>\n<gouv-facets id=\"filtered\" source=\"searched\"\n  fields=\"categorie, region\">\n</gouv-facets>\n<gouv-display source=\"filtered\" ...>...</gouv-display>\n\n<!-- Recherche avec highlight -->\n<gouv-search id=\"searched\" source=\"clean\" highlight count>\n</gouv-search>\n<gouv-display source=\"searched\" cols=\"1\">\n  <template>\n    <h3>{{nom}}</h3>\n    <p>{{{_highlight}}}</p>\n  </template>\n</gouv-display>\n\n<!-- Recherche pre-remplie depuis URL (ex: ?q=ecole) -->\n<gouv-search id=\"searched\" source=\"clean\"\n  url-search-param=\"q\" count>\n</gouv-search>\n\n<!-- Recherche avec sync URL bidirectionnelle -->\n<gouv-search id=\"searched\" source=\"clean\"\n  url-search-param=\"q\" url-sync count>\n</gouv-search>\n```"
  },
  {
    "id": "gouvKpi",
    "name": "gouv-kpi",
    "description": "Composant KPI avec agregation, seuils et tendances",
    "trigger": [
      "kpi",
      "indicateur",
      "chiffre",
      "valeur",
      "tendance",
      "seuil",
      "pourcentage",
      "euro",
      "metrique"
    ],
    "content": "## <gouv-kpi> - Indicateur chiffre cle\n\nAffiche une valeur numerique mise en avant avec formatage, couleur conditionnelle, icone et tendance.\nSe connecte a une gouv-source ou gouv-query via l'attribut `source`.\n\n### Format des donnees\nAttend un tableau d'objets. L'attribut `valeur` determine comment extraire/agreger la donnee :\n- Valeur directe d'un champ : `valeur=\"score\"` (prend le 1er enregistrement)\n- Agregation sur tout le tableau : `valeur=\"avg:score\"`, `valeur=\"sum:montant\"`\n\n### Attributs\n| Attribut | Type | Defaut | Requis | Description |\n|----------|------|--------|--------|-------------|\n| source | String | `\"\"` | oui | ID de la gouv-source ou gouv-query |\n| valeur | String | `\"\"` | oui | Expression : `\"champ\"`, `\"avg:champ\"`, `\"sum:champ\"`, `\"min:champ\"`, `\"max:champ\"`, `\"count:champ:valeur\"` |\n| label | String | `\"\"` | non | Libelle sous la valeur |\n| description | String | `\"\"` | non | Description pour accessibilite (sr-only) |\n| icone | String | `\"\"` | non | Classe Remix Icon : `ri-global-line`, `ri-money-euro-circle-line`, etc. |\n| format | String | `\"nombre\"` | non | Format : nombre, pourcentage, euro, decimal |\n| tendance | String | `\"\"` | non | Expression de tendance : valeur fixe (`\"+3.2\"`) ou agregation |\n| couleur | String | `\"\"` | non | Forcer la couleur : vert, orange, rouge, bleu |\n| seuil-vert | Number | - | non | Seuil au-dessus duquel couleur = vert |\n| seuil-orange | Number | - | non | Seuil au-dessus duquel couleur = orange (en-dessous = rouge) |\n\n### Logique des couleurs\n1. Si `couleur` est defini : applique cette couleur directement\n2. Si `seuil-vert` et `seuil-orange` sont definis : couleur automatique selon la valeur\n   - valeur >= seuil-vert -> vert (success)\n   - valeur >= seuil-orange -> orange (warning)\n   - valeur < seuil-orange -> rouge (error)\n3. Sinon : bleu par defaut (info)\n\n### Expressions d'agregation (attribut valeur)\n| Expression | Description | Exemple |\n|-----------|-------------|---------|\n| `\"champ\"` | Valeur directe du 1er enregistrement | `valeur=\"score_rgaa\"` |\n| `\"avg:champ\"` | Moyenne de tous les enregistrements | `valeur=\"avg:score\"` |\n| `\"sum:champ\"` | Somme | `valeur=\"sum:montant\"` |\n| `\"min:champ\"` | Minimum | `valeur=\"min:prix\"` |\n| `\"max:champ\"` | Maximum | `valeur=\"max:prix\"` |\n| `\"count:champ:valeur\"` | Nombre d'items ou champ = valeur | `valeur=\"count:status:active\"` |\n\n### Exemples\n```html\n<!-- KPI simple avec somme et unite -->\n<gouv-kpi source=\"stats\"\n  valeur=\"sum:montant\"\n  label=\"CA total\"\n  format=\"euro\"\n  icone=\"ri-money-euro-circle-line\">\n</gouv-kpi>\n\n<!-- KPI avec seuils de couleur automatiques -->\n<gouv-kpi source=\"audit\"\n  valeur=\"avg:score_rgaa\"\n  label=\"Score RGAA moyen\"\n  format=\"pourcentage\"\n  seuil-vert=\"80\"\n  seuil-orange=\"50\">\n</gouv-kpi>\n\n<!-- KPI avec couleur forcee et tendance -->\n<gouv-kpi source=\"data\"\n  valeur=\"count:status:active\"\n  label=\"Sites actifs\"\n  couleur=\"bleu\"\n  tendance=\"+12\">\n</gouv-kpi>\n```"
  },
  {
    "id": "gouvDsfrChart",
    "name": "gouv-dsfr-chart",
    "description": "Wrapper DSFR Chart connecte aux sources de donnees",
    "trigger": [
      "graphique",
      "chart",
      "visualisation",
      "barres",
      "camembert",
      "ligne",
      "radar",
      "nuage",
      "scatter",
      "carte",
      "map",
      "jauge",
      "gauge",
      "departement",
      "region"
    ],
    "content": "## <gouv-dsfr-chart> - Graphiques DSFR\n\nWrapper connectant les composants DSFR Chart officiels au systeme gouv-source/gouv-query.\nSe connecte a une source via l'attribut `source`. Genere automatiquement le format\nJSON imbrique attendu par les composants DSFR Chart natifs.\n\n### Format des donnees\nAttend un tableau d'objets plats depuis la source :\n`[{\"region\": \"IDF\", \"population\": 12000000}, {\"region\": \"OCC\", \"population\": 6000000}]`\n\nLes champs `label-field` et `value-field` indiquent quels champs utiliser pour\nles labels (axe X) et les valeurs (axe Y). Le composant transforme automatiquement\nce tableau en format DSFR Chart (tableaux imbriques x/y).\n\n### Types supportes\n| Type | Composant DSFR | Description |\n|------|---------------|-------------|\n| bar | bar-chart | Barres verticales (ou horizontales avec `horizontal`) |\n| line | line-chart | Courbes / lignes |\n| pie | pie-chart | Anneau (defaut) ou camembert plein (avec `fill`) |\n| radar | radar-chart | Diagramme radar |\n| scatter | scatter-chart | Nuage de points |\n| gauge | gauge-chart | Jauge circulaire 0-100% |\n| bar-line | bar-chart + line-chart | Combine barres et ligne (2 series) |\n| map | map-chart | Carte par departement francais |\n| map-reg | map-chart-reg | Carte par region francaise |\n\n### Attributs\n| Attribut | Type | Defaut | Requis | Description |\n|----------|------|--------|--------|-------------|\n| source | String | `\"\"` | oui | ID de la source ou query |\n| type | String | `\"bar\"` | oui | Type de graphique (voir tableau ci-dessus) |\n| label-field | String | `\"\"` | selon type | Chemin vers les labels dans les donnees |\n| value-field | String | `\"\"` | oui (sauf gauge) | Chemin vers les valeurs |\n| value-field-2 | String | `\"\"` | non | 2e serie de valeurs (bar-line) |\n| name | String | `\"\"` | non | Noms des series en JSON : `'[\"Serie 1\",\"Serie 2\"]'` |\n| selected-palette | String | `\"categorical\"` | non | Palette : categorical, sequentialAscending, sequentialDescending, divergentAscending, divergentDescending, neutral, default |\n| unit-tooltip | String | `\"\"` | non | Unite dans les info-bulles : %, EUR, etc. |\n| unit-tooltip-bar | String | `\"\"` | non | Unite des barres dans un bar-line |\n| horizontal | Boolean | `false` | non | Barres horizontales (type bar uniquement) |\n| stacked | Boolean | `false` | non | Barres empilees (type bar uniquement) |\n| fill | Boolean | `false` | non | Camembert plein au lieu d'anneau (type pie) |\n| highlight-index | String | `\"\"` | non | Indices a mettre en avant : `\"[0, 2]\"` |\n| x-min | String | `\"\"` | non | Limite min axe X |\n| x-max | String | `\"\"` | non | Limite max axe X |\n| y-min | String | `\"\"` | non | Limite min axe Y |\n| y-max | String | `\"\"` | non | Limite max axe Y |\n| gauge-value | Number | `null` | type gauge | Valeur de la jauge (0-100) |\n| code-field | String | `\"\"` | type map/map-reg | Champ contenant le code departement ou region (prioritaire sur label-field) |\n| map-highlight | String | `\"\"` | non | Departements/regions a surligner |\n\n### Attributs par type de graphique\n| Type | Attributs essentiels | Attributs optionnels |\n|------|---------------------|---------------------|\n| bar | source, type, label-field, value-field | horizontal, stacked, highlight-index, selected-palette |\n| line | source, type, label-field, value-field | x-min, x-max, y-min, y-max, value-field-2 |\n| pie | source, type, label-field, value-field | fill (false=anneau, true=camembert plein) |\n| radar | source, type, label-field, value-field | value-field-2, name |\n| scatter | source, type, label-field, value-field | x-min, x-max, y-min, y-max |\n| gauge | source, type, gauge-value | - |\n| bar-line | source, type, label-field, value-field, value-field-2 | name, unit-tooltip, unit-tooltip-bar |\n| map | source, type, code-field, value-field | selected-palette, map-highlight |\n| map-reg | source, type, code-field, value-field | selected-palette, map-highlight |\n\n### Exemples\n```html\n<!-- Barres verticales -->\n<gouv-dsfr-chart source=\"stats\" type=\"bar\"\n  label-field=\"region\" value-field=\"population\"\n  selected-palette=\"categorical\">\n</gouv-dsfr-chart>\n\n<!-- Barres horizontales empilees -->\n<gouv-dsfr-chart source=\"data\" type=\"bar\"\n  label-field=\"categorie\" value-field=\"valeur\"\n  horizontal stacked>\n</gouv-dsfr-chart>\n\n<!-- Combine barres + ligne -->\n<gouv-dsfr-chart source=\"data\" type=\"bar-line\"\n  label-field=\"mois\" value-field=\"ca\" value-field-2=\"objectif\"\n  name='[\"CA\",\"Objectif\"]'\n  unit-tooltip=\"EUR\" unit-tooltip-bar=\"EUR\">\n</gouv-dsfr-chart>\n\n<!-- Anneau (defaut de pie) -->\n<gouv-dsfr-chart source=\"repartition\" type=\"pie\"\n  label-field=\"categorie\" value-field=\"montant\"\n  unit-tooltip=\"%\">\n</gouv-dsfr-chart>\n\n<!-- Camembert plein -->\n<gouv-dsfr-chart source=\"repartition\" type=\"pie\"\n  label-field=\"categorie\" value-field=\"montant\" fill>\n</gouv-dsfr-chart>\n\n<!-- Carte par departement -->\n<gouv-dsfr-chart source=\"dept-data\" type=\"map\"\n  code-field=\"code_dept\" value-field=\"valeur\"\n  selected-palette=\"sequentialAscending\">\n</gouv-dsfr-chart>\n\n<!-- Carte par region -->\n<gouv-dsfr-chart source=\"reg-data\" type=\"map-reg\"\n  code-field=\"code_reg\" value-field=\"valeur\">\n</gouv-dsfr-chart>\n\n<!-- Jauge -->\n<gouv-dsfr-chart type=\"gauge\" gauge-value=\"73\"></gouv-dsfr-chart>\n```"
  },
  {
    "id": "gouvDatalist",
    "name": "gouv-datalist",
    "description": "Tableau de donnees avec recherche, filtres, tri, pagination et export CSV/HTML",
    "trigger": [
      "tableau",
      "table",
      "liste",
      "colonnes",
      "pagination",
      "exporter",
      "csv",
      "html",
      "recherche",
      "datalist"
    ],
    "content": "## <gouv-datalist> - Tableau de donnees\n\nAffiche un tableau DSFR filtrable, triable, paginable avec export CSV et/ou HTML.\nSe connecte a une gouv-source ou gouv-query via l'attribut `source`.\n\n### Format des donnees\nAttend un tableau d'objets plats. Les colonnes sont definies par l'attribut `colonnes`\nau format `\"cle_json:Label affiche, cle2:Label2\"`. Si `colonnes` est omis, toutes\nles cles du premier objet sont utilisees comme colonnes.\n\n### Attributs\n| Attribut | Type | Defaut | Requis | Description |\n|----------|------|--------|--------|-------------|\n| source | String | `\"\"` | oui | ID de la source ou query |\n| colonnes | String | `\"\"` | non | Definition des colonnes : `\"key:Label, key2:Label2\"` |\n| recherche | Boolean | `false` | non | Afficher la barre de recherche full-text |\n| filtres | String | `\"\"` | non | Colonnes filtrables (dropdown) : `\"col1,col2\"` |\n| tri | String | `\"\"` | non | Tri par defaut : `\"col:asc\"` ou `\"col:desc\"` |\n| pagination | Number | `0` | non | Lignes par page (0 = tout afficher sans pagination) |\n| export | String | `\"\"` | non | Formats d'export : `\"csv\"`, `\"html\"` ou `\"csv,html\"` |\n\n### Exemples\n```html\n<!-- Tableau simple -->\n<gouv-datalist source=\"data\"\n  colonnes=\"nom:Nom, email:Email, ville:Ville\">\n</gouv-datalist>\n\n<!-- Tableau complet avec toutes les fonctionnalites -->\n<gouv-datalist source=\"sites\"\n  colonnes=\"nom:Nom du site, ministere:Ministere, score_rgaa:Score RGAA\"\n  recherche\n  filtres=\"ministere\"\n  tri=\"score_rgaa:desc\"\n  pagination=\"20\"\n  export=\"csv,html\">\n</gouv-datalist>\n```"
  },
  {
    "id": "gouvDisplay",
    "name": "gouv-display",
    "description": "Affichage dynamique de donnees via template HTML (cartes, tuiles, listes)",
    "trigger": [
      "cartes",
      "carte",
      "tuiles",
      "tuile",
      "cards",
      "tiles",
      "display",
      "template",
      "affichage",
      "liste de resultats",
      "motif repetitif"
    ],
    "content": "## <gouv-display> - Affichage dynamique via template\n\nGenere des elements HTML repetitifs (cartes DSFR, tuiles, callouts, etc.) a partir\nd'un template et d'une source de donnees. Chaque element du tableau de donnees produit\nune instance du template avec les valeurs injectees.\n\n### Syntaxe du template\nLe template est defini dans un element `<template>` enfant du composant.\nLes placeholders sont remplaces pour chaque element de donnees :\n\n| Syntaxe | Description |\n|---------|-------------|\n| `{{champ}}` | Valeur echappee (HTML-safe) |\n| `{{{champ}}}` | Valeur brute (non echappee — utiliser avec precaution) |\n| `{{champ|defaut}}` | Valeur avec fallback si null/undefined |\n| `{{champ.sous.cle}}` | Acces aux proprietes imbriquees (dot notation) |\n| `{{$index}}` | Index de l'element dans le tableau (0-based) |\n| `{{$uid}}` | Identifiant unique de l'element (base sur uid-field ou index) |\n\n### Attributs\n| Attribut | Type | Defaut | Requis | Description |\n|----------|------|--------|--------|-------------|\n| source | String | `\"\"` | oui | ID de la source, query ou normalize |\n| cols | Number | `1` | non | Nombre de colonnes dans la grille (1-6) |\n| pagination | Number | `0` | non | Elements par page (0 = tout afficher) |\n| empty | String | `\"Aucun resultat\"` | non | Message quand le tableau est vide |\n| gap | String | `\"fr-grid-row--gutters\"` | non | Classe CSS de gap pour la grille |\n| uid-field | String | `\"\"` | non | Champ de donnees pour l'ID unique par item. Chaque item recoit un id=\"item-{valeur}\" pour ancrage URL |\n\n### Exemples\n```html\n<!-- Cartes DSFR en grille 3 colonnes avec pagination -->\n<gouv-display source=\"data\" cols=\"3\" pagination=\"12\">\n  <template>\n    <div class=\"fr-card\">\n      <div class=\"fr-card__body\">\n        <div class=\"fr-card__content\">\n          <h3 class=\"fr-card__title\">{{titre}}</h3>\n          <p class=\"fr-card__desc\">{{description}}</p>\n        </div>\n        <div class=\"fr-card__footer\">\n          <p class=\"fr-badge fr-badge--sm\">{{categorie}}</p>\n        </div>\n      </div>\n    </div>\n  </template>\n</gouv-display>\n\n<!-- Tuiles DSFR simples -->\n<gouv-display source=\"data\" cols=\"4\">\n  <template>\n    <div class=\"fr-tile\">\n      <div class=\"fr-tile__body\">\n        <div class=\"fr-tile__content\">\n          <h3 class=\"fr-tile__title\">{{nom}}</h3>\n          <p class=\"fr-tile__desc\">{{description|Pas de description}}</p>\n        </div>\n      </div>\n    </div>\n  </template>\n</gouv-display>\n\n<!-- Cartes avec identifiants uniques et ancrage URL (ex: page.html#item-42) -->\n<gouv-display source=\"data\" cols=\"3\" pagination=\"12\" uid-field=\"id\">\n  <template>\n    <div class=\"fr-card\">\n      <div class=\"fr-card__body\">\n        <div class=\"fr-card__content\">\n          <h3 class=\"fr-card__title\">\n            <a href=\"#{{$uid}}\">{{titre}}</a>\n          </h3>\n          <p class=\"fr-card__desc\">{{description}}</p>\n        </div>\n      </div>\n    </div>\n  </template>\n</gouv-display>\n```"
  },
  {
    "id": "dsfrChartNative",
    "name": "Composants DSFR Chart natifs",
    "description": "Attributs detailles des composants line-chart, bar-chart, pie-chart, etc.",
    "trigger": [
      "dsfr",
      "natif",
      "officiel",
      "accessibilite",
      "rgaa",
      "bar-chart",
      "line-chart",
      "pie-chart",
      "map-chart",
      "gauge-chart"
    ],
    "content": "## Composants DSFR Chart natifs\n\nLes composants DSFR Chart sont des Web Components Vue utilises en interne par gouv-dsfr-chart.\nEn usage direct (sans gouv-dsfr-chart), ils acceptent des donnees au format JSON stringifie.\n\nNOTE : preferer gouv-dsfr-chart qui gere automatiquement le format de donnees.\nN'utiliser les composants natifs que pour des cas avances.\n\n### Format des donnees\n```html\nx='[[\"Jan\",\"Fev\",\"Mar\"]]'     <!-- Labels (tableau imbrique) -->\ny='[[100, 200, 150]]'         <!-- Valeurs (tableau imbrique) -->\n<!-- Multi-series -->\nx='[[\"Jan\",\"Fev\"],[\"Jan\",\"Fev\"]]'\ny='[[100, 200],[150, 180]]'\nname='[\"Serie A\",\"Serie B\"]'\n```\n\n### <bar-chart>\n- horizontal : barres horizontales\n- stacked : barres empilees\n- highlight-index='[3]' : mettre en avant une barre\n\n### <line-chart>\n- x-min, x-max, y-min, y-max : limites des axes\n\n### <pie-chart>\n- fill=\"true\" : camembert plein (defaut: anneau/donut)\n\n### <gauge-chart>\n- percent : valeur actuelle (0-100)\n- init : valeur de depart\n- target : valeur cible\n\n### <scatter-chart>\n- x, y : coordonnees des points\n\n### <radar-chart>\n- Multi-series pour comparer des profils\n\n### <map-chart> (carte par departement)\n- data='{\"75\": 95, \"69\": 78, \"2A\": 60}' : JSON code_dept -> valeur\n- Codes departements valides : 01-95, 2A, 2B, 971-976\n- name : nom de l'indicateur\n- value-nat : valeur nationale de reference\n- selected-palette : palette de couleurs\n\n### <map-chart-reg> (carte par region)\n- Meme format que map-chart avec codes region\n\n### Attributs communs\n- selected-palette : categorical, sequentialAscending, sequentialDescending, divergentAscending, divergentDescending, neutral, default\n- unit-tooltip : unite dans les info-bulles\n- name : noms des series en JSON"
  },
  {
    "id": "compositionPatterns",
    "name": "Patterns de composition",
    "description": "Assembler source, query et visualisations en dashboards",
    "trigger": [
      "dashboard",
      "tableau de bord",
      "assembler",
      "combiner",
      "pipeline",
      "plusieurs",
      "ensemble",
      "complet",
      "page",
      "embarquer",
      "integrer"
    ],
    "content": "## Patterns de composition gouv-widgets\n\n### Architecture : composants freres lies par ID\nLes composants gouv-widgets sont des elements HTML freres (pas imbriques).\nIls communiquent via un bus evenementiel interne : `source=\"id-de-la-source\"`.\n```\n<gouv-source id=\"X\">   --dispatch-->   <gouv-query source=\"X\">   --dispatch-->   <gouv-dsfr-chart source=\"...\">\n```\n\n### Pipeline standard : Source -> Query -> Visualisation\n```html\n<gouv-source id=\"data\"\n  url=\"https://api.exemple.fr/records\"\n  transform=\"results\">\n</gouv-source>\n\n<gouv-query id=\"top10\" source=\"data\"\n  group-by=\"region\"\n  aggregate=\"population:sum\"\n  order-by=\"population__sum:desc\"\n  limit=\"10\">\n</gouv-query>\n\n<gouv-dsfr-chart source=\"top10\" type=\"bar\"\n  label-field=\"region\" value-field=\"population__sum\"\n  selected-palette=\"categorical\">\n</gouv-dsfr-chart>\n```\n\n### Pipeline simplifie : Source -> Visualisation (sans transformation)\n```html\n<gouv-source id=\"data\" url=\"https://api.fr/records\" transform=\"results\"></gouv-source>\n<gouv-dsfr-chart source=\"data\" type=\"line\" label-field=\"date\" value-field=\"valeur\"></gouv-dsfr-chart>\n```\n\n### Multi-consommation : 1 source -> N visualisations\n```html\n<gouv-source id=\"sites\" url=\"https://api.fr/sites\" transform=\"results\"></gouv-source>\n\n<!-- KPIs -->\n<gouv-kpi source=\"sites\" valeur=\"count:status:active\" label=\"Sites actifs\" couleur=\"vert\"></gouv-kpi>\n<gouv-kpi source=\"sites\" valeur=\"avg:score_rgaa\" label=\"Score RGAA moyen\" format=\"pourcentage\" seuil-vert=\"80\" seuil-orange=\"50\"></gouv-kpi>\n\n<!-- Graphique -->\n<gouv-dsfr-chart source=\"sites\" type=\"bar\" label-field=\"ministere\" value-field=\"score_rgaa\" selected-palette=\"categorical\"></gouv-dsfr-chart>\n\n<!-- Tableau -->\n<gouv-datalist source=\"sites\" colonnes=\"nom:Nom, ministere:Ministere, score_rgaa:Score\" recherche filtres=\"ministere\" tri=\"score_rgaa:desc\" pagination=\"20\" export=\"csv\"></gouv-datalist>\n```\n\n### Chainabilite des queries\n```html\n<gouv-source id=\"raw\" url=\"...\" transform=\"data\"></gouv-source>\n<gouv-query id=\"actifs\" source=\"raw\" where=\"status:eq:active\"></gouv-query>\n<gouv-query id=\"top5\" source=\"actifs\" group-by=\"region\" aggregate=\"montant:sum\" order-by=\"montant__sum:desc\" limit=\"5\"></gouv-query>\n<gouv-dsfr-chart source=\"top5\" type=\"pie\" label-field=\"region\" value-field=\"montant__sum\"></gouv-dsfr-chart>\n```\n\n### Pipeline Grist / ODS v1 : Source -> Normalize(flatten) -> Visualisation\n\nPour les APIs qui wrappent les donnees sous un sous-objet (`fields`, `properties`),\n`gouv-normalize` avec `flatten` permet de conserver un pipeline 100% declaratif :\n\n```html\n<gouv-source id=\"raw\"\n  url=\"https://grist.example.com/api/docs/DOC_ID/tables/TABLE/records\"\n  transform=\"records\">\n</gouv-source>\n\n<gouv-normalize id=\"clean\" source=\"raw\"\n  flatten=\"fields\"\n  trim numeric-auto>\n</gouv-normalize>\n\n<gouv-facets id=\"filtered\" source=\"clean\"\n  fields=\"categorie, region\"\n  labels=\"categorie:Categorie | region:Region\">\n</gouv-facets>\n\n<gouv-display source=\"filtered\" cols=\"3\" pagination=\"12\">\n  <template>\n    <div class=\"fr-card\">\n      <div class=\"fr-card__body\">\n        <div class=\"fr-card__content\">\n          <h3 class=\"fr-card__title\">{{nom}}</h3>\n          <p class=\"fr-badge fr-badge--sm\">{{categorie}}</p>\n        </div>\n      </div>\n    </div>\n  </template>\n</gouv-display>\n```\n\n### Pipeline avec recherche : Source -> Search -> Facets -> Visualisation\n```html\n<gouv-source id=\"data\" url=\"https://api.exemple.fr/records\" transform=\"results\"></gouv-source>\n<gouv-normalize id=\"clean\" source=\"data\" trim></gouv-normalize>\n\n<gouv-search id=\"searched\" source=\"clean\"\n  fields=\"nom, description\"\n  placeholder=\"Rechercher...\"\n  operator=\"words\" count>\n</gouv-search>\n\n<gouv-facets id=\"filtered\" source=\"searched\"\n  fields=\"categorie, region\">\n</gouv-facets>\n\n<gouv-display source=\"filtered\" cols=\"3\" pagination=\"12\">\n  <template>\n    <div class=\"fr-card\">\n      <div class=\"fr-card__body\">\n        <div class=\"fr-card__content\">\n          <h3 class=\"fr-card__title\">{{nom}}</h3>\n          <p class=\"fr-badge fr-badge--sm\">{{categorie}}</p>\n        </div>\n      </div>\n    </div>\n  </template>\n</gouv-display>\n```\n\nLa recherche et les facettes se combinent : la recherche reduit le jeu,\nles facettes affinent. Les KPI et graphiques en aval se mettent a jour en temps reel.\n\n### Format de sortie : snippet embarquable (PAS une page HTML complete)\nLe code genere doit etre un **snippet** pret a copier-coller dans une page existante.\n- **NE PAS** generer `<!DOCTYPE html>`, `<html>`, `<head>`, `<body>` ni `<meta>`.\n- Generer uniquement : les dependances CDN (liens CSS + scripts) puis les composants HTML.\n- L'utilisateur collera ce snippet dans sa propre page.\n\n### Dependances CDN requises\nToujours inclure ces 6 dependances dans cet ordre exact :\n```html\n<!-- CSS DSFR (obligatoire) -->\n<link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/@gouvfr/dsfr@1.11.2/dist/dsfr.min.css\">\n<link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/@gouvfr/dsfr@1.11.2/dist/utility/utility.min.css\">\n\n<!-- DSFR Chart (obligatoire pour les graphiques) -->\n<link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/@gouvfr/dsfr-chart@2.0.4/dist/DSFRChart/DSFRChart.css\">\n<script src=\"https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js\"></script>\n<script type=\"module\" src=\"https://cdn.jsdelivr.net/npm/@gouvfr/dsfr-chart@2.0.4/dist/DSFRChart/DSFRChart.js\"></script>\n\n<!-- gouv-widgets (obligatoire) -->\n<script src=\"https://chartsbuilder.matge.com/dist/gouv-widgets.umd.js\"></script>\n```\n\n### Exemple de snippet complet\n```html\n<link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/@gouvfr/dsfr@1.11.2/dist/dsfr.min.css\">\n<link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/@gouvfr/dsfr@1.11.2/dist/utility/utility.min.css\">\n<link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/@gouvfr/dsfr-chart@2.0.4/dist/DSFRChart/DSFRChart.css\">\n<script src=\"https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js\"></script>\n<script type=\"module\" src=\"https://cdn.jsdelivr.net/npm/@gouvfr/dsfr-chart@2.0.4/dist/DSFRChart/DSFRChart.js\"></script>\n<script src=\"https://chartsbuilder.matge.com/dist/gouv-widgets.umd.js\"></script>\n\n<gouv-source id=\"data\" url=\"VOTRE_URL_API\" transform=\"results\"></gouv-source>\n<gouv-dsfr-chart source=\"data\" type=\"bar\" label-field=\"CHAMP_LABEL\" value-field=\"CHAMP_VALEUR\"></gouv-dsfr-chart>\n```"
  },
  {
    "id": "odsql",
    "name": "ODSQL (OpenDataSoft Query Language)",
    "description": "Syntaxe de requetes pour les APIs OpenDataSoft",
    "trigger": [
      "odsql",
      "opendatasoft"
    ],
    "content": "## ODSQL - OpenDataSoft Query Language\n\nSyntaxe de requetes utilisee par les APIs OpenDataSoft (mode `api-type=\"opendatasoft\"` de gouv-query)\net par l'action `reloadData` du builder-IA.\n\n### Parametres de requete\n| Parametre | Description | Exemple |\n|-----------|-------------|---------|\n| select | Champs a retourner (avec aliases) | `select=nom,population` ou `select=avg(prix) as prix_moyen` |\n| where | Condition de filtrage | `where=population>10000` ou `where=nom like \"Paris%\"` |\n| group_by | Champ de groupement | `group_by=region` |\n| order_by | Tri | `order_by=population DESC` |\n| limit | Max resultats (defaut: 10, max: 100 par requete) | `limit=100` |\n| offset | Pagination | `offset=100` |\n\nIMPORTANT : `limit` est plafonne a 100 par requete par l'API ODS.\ngouv-query gere automatiquement la pagination via offset quand la limite demandee > 100\n(ex: cartes departementales avec 101 departements). Max 10 pages (1000 resultats).\n\n### Fonctions d'agregation ODSQL\n- count(*), count(champ)\n- sum(champ), avg(champ), min(champ), max(champ)\n- percentile(champ, 50) pour la mediane\n\n### Operateurs WHERE (syntaxe SQL)\n| Operateur | Exemple |\n|-----------|---------|\n| =, !=, <, >, <=, >= | `population > 10000` |\n| like, not like | `nom like \"Paris%\"` (% = wildcard) |\n| in, not in | `region in (\"IDF\",\"PACA\")` |\n| is null, is not null | `email is not null` |\n| and, or, not | `population > 10000 and region = \"IDF\"` |\n\n### Fonctions sur les dates\n- year(date), month(date), day(date)\n- date_format(date, \"YYYY-MM\")\n\n### Exemple complet\n`?select=region,avg(prix) as prix_moyen&where=annee>=2020&group_by=region&order_by=prix_moyen DESC&limit=10`\n\nNOTE : ne pas confondre la syntaxe ODSQL (SQL-like) avec la syntaxe de filtre\ngouv-query mode generic (`\"champ:operateur:valeur\"`). Ce sont deux systemes distincts."
  },
  {
    "id": "odsApiVersions",
    "name": "Versions API OpenDataSoft",
    "description": "Differences entre v1, v2 et v2.1",
    "trigger": [
      "version",
      "v1",
      "v2",
      "v2.1",
      "migration"
    ],
    "content": "## Versions des APIs OpenDataSoft\n\n### API v2.1 (recommandee)\n- URL: `/api/explore/v2.1/catalog/datasets/{dataset_id}/records`\n- Reponse: `{ results: [...], total_count: N }`\n- `transform=\"results\"` pour gouv-source\n- ODSQL complet supporte\n- Pagination: limit + offset\n\n### API v2.0\n- URL: `/api/v2/catalog/datasets/{dataset_id}/records`\n- Similaire a v2.1, quelques fonctions ODSQL manquantes\n- Deprecie, preferer v2.1\n\n### API v1 (legacy)\n- URL: `/api/records/1.0/search/?dataset={dataset_id}`\n- Reponse: `{ records: [{ fields: {...}, recordid: \"...\" }] }`\n- `transform=\"records\"` puis les donnees sont dans `record.fields`\n- Parametres differents: q (recherche), refine, exclude, rows, start\n\n### Detection automatique\n- URL contient `/v2.1/` -> v2.1\n- URL contient `/v2/` -> v2\n- URL contient `/1.0/` ou `rows=` -> v1\n- Par defaut essayer v2.1\n\n### Migration v1 -> v2.1\n| v1 | v2.1 |\n|---|---|\n| rows=N | limit=N |\n| start=N | offset=N |\n| q=texte | where=search(champ,\"texte\") |\n| refine.champ=val | where=champ=\"val\" |\n| record.fields.X | record.X |\n\n### API v1 avec gouv-widgets\nL'API v1 renvoie `records[].fields`. Utiliser `transform=\"records\"` sur gouv-source\npuis `flatten=\"fields\"` sur gouv-normalize :\n```html\n<gouv-source id=\"raw\" url=\"…/1.0/search/?dataset=X&rows=100\" transform=\"records\"></gouv-source>\n<gouv-normalize id=\"clean\" source=\"raw\" flatten=\"fields\" trim></gouv-normalize>\n```"
  },
  {
    "id": "chartTypes",
    "name": "Types de graphiques",
    "description": "Quand utiliser quel type de graphique",
    "trigger": [
      "quel graphique",
      "quel type",
      "quel chart",
      "recommand"
    ],
    "content": "## Choix du type de graphique\n\nGuide pour choisir le type de visualisation adapte aux donnees.\n\n### Barres verticales (bar)\n- **Quand** : comparer des categories (5-15 ideal)\n- **Champs** : label-field (categories), value-field (valeurs)\n- **Options** : `horizontal` (barres horizontales), `stacked` (empile)\n- **Supporte** : value-field-2 pour 2e serie, highlight-index\n\n### Lignes (line)\n- **Quand** : evolution temporelle, tendances\n- **Champs** : label-field (dates/temps), value-field (valeurs)\n- **Supporte** : value-field-2 pour comparaison, x-min/x-max/y-min/y-max\n\n### Combine barres + ligne (bar-line)\n- **Quand** : comparer 2 metriques differentes (ex: CA en barres + objectif en ligne)\n- **Champs** : label-field, value-field (barres), value-field-2 (ligne)\n- **Options** : unit-tooltip (barres), unit-tooltip-bar (ligne)\n\n### Camembert / Anneau (pie)\n- **Quand** : parts d'un tout (100%), max 5-7 segments\n- **Champs** : label-field (categories), value-field (valeurs)\n- **Options** : `fill` (true = camembert plein, false = anneau par defaut)\n\n### Radar\n- **Quand** : profils multicriteres, comparaison de dimensions\n- **Champs** : label-field (criteres), value-field (scores)\n- **Supporte** : value-field-2 pour comparer 2 profils\n\n### Nuage de points (scatter)\n- **Quand** : correlation entre deux variables numeriques\n- **Champs** : label-field (axe X numerique), value-field (axe Y)\n\n### Jauge (gauge)\n- **Quand** : progression vers un objectif (0-100%)\n- **Champs** : gauge-value uniquement (PAS de label-field ni source obligatoire)\n\n### KPI (kpi - composant gouv-kpi)\n- **Quand** : afficher UNE valeur cle (total, moyenne, comptage)\n- **Champs** : valeur (expression d'agregation), PAS de label-field\n- **Options** : format (nombre, pourcentage, euro), couleur, seuils\n\n### Carte departements (map)\n- **Quand** : donnees geographiques par departement francais\n- **Champs** : code-field (code INSEE: 01-95, 2A, 2B, 971-976), value-field\n- **Palette recommandee** : sequentialAscending\n\n### Carte regions (map-reg)\n- **Quand** : donnees geographiques par region francaise\n- **Champs** : code-field (code region), value-field\n\n### Series multiples (bar, line, bar-line, radar)\nUtiliser value-field-2 pour une seconde serie. Definir les noms avec `name='[\"Serie 1\",\"Serie 2\"]'`."
  },
  {
    "id": "dsfrColors",
    "name": "Couleurs DSFR",
    "description": "Palette officielle du Design System de l'Etat",
    "trigger": [
      "couleur",
      "color",
      "palette",
      "style"
    ],
    "content": "## Couleurs et palettes DSFR\n\n### Couleurs hex principales\n- **Bleu France**: #000091 (couleur par defaut)\n- **Emeraude**: #009081 (succes)\n- **Marianne**: #C9191E (erreur)\n- **Orange**: #FF9940 (avertissement)\n- **Violet**: #A558A0\n- **Bleu ciel**: #417DC4\n- **Vert foret**: #18753C\n\n### Palettes DSFR Chart (attribut selected-palette)\n| Palette | Usage recommande |\n|---------|-----------------|\n| categorical | Comparer des groupes distincts (defaut pour bar, pie, radar) |\n| sequentialAscending | Gradient clair -> fonce (recommande pour map, classements) |\n| sequentialDescending | Gradient fonce -> clair |\n| divergentAscending | Echelle divergente (ecarts positifs/negatifs) |\n| divergentDescending | Echelle divergente inversee |\n| neutral | Neutre, utiliser avec highlight-index pour mettre en avant 1 barre |\n| default | Bleu France seul (serie unique) |\n\n### Bonnes pratiques\n- Utiliser `categorical` pour pie, radar et comparaisons multi-categories\n- Utiliser `sequentialAscending` pour les cartes (map, map-reg)\n- Utiliser `neutral` + `highlight-index` pour mettre en avant une valeur\n- Assurer un contraste suffisant (conformite RGAA)\n- Eviter le rouge/vert seuls (daltonisme) - les palettes DSFR sont concues pour ca"
  },
  {
    "id": "troubleshooting",
    "name": "Troubleshooting",
    "description": "Pieges courants et erreurs frequentes",
    "trigger": [
      "erreur",
      "bug",
      "marche pas",
      "probleme",
      "vide",
      "affiche pas",
      "ne fonctionne pas"
    ],
    "content": "## Pieges courants et troubleshooting\n\n### 1. Le graphique est vide / ne s'affiche pas\n- **Verifier `transform`** : l'API retourne souvent un objet enveloppe (`{results: [...]}`).\n  Si `transform` n'est pas defini ou pointe au mauvais endroit, les donnees seront vides.\n  Exemples : `transform=\"results\"` (ODS v2.1), `transform=\"data\"` (Tabular), `transform=\"records\"` (ODS v1)\n- **Verifier les noms de champs** : `label-field` et `value-field` doivent correspondre\n  exactement aux cles des objets JSON retournes (sensible a la casse).\n- **Verifier `source`** : l'attribut `source=\"xxx\"` doit correspondre exactement a l'`id=\"xxx\"`\n  de la gouv-source ou gouv-query (sensible a la casse).\n\n### 2. La carte ne s'affiche pas correctement\n- **Codes departements** : utiliser des codes INSEE (string) : \"01\" a \"95\", \"2A\", \"2B\", \"971\" a \"976\".\n  Attention au zero initial (\"01\" et non 1).\n- **Utiliser code-field** (pas label-field) pour les cartes.\n- **Patience** : les composants DSFR Chart map sont des Web Components Vue qui ecrasent\n  certains attributs au montage. gouv-dsfr-chart applique un delai de 500ms pour re-injecter\n  les valeurs. Le graphique peut mettre ~1s a apparaitre.\n\n### 3. Limite de 100 resultats (API ODS)\nL'API OpenDataSoft retourne maximum 100 enregistrements par requete.\ngouv-query en mode `opendatasoft` gere automatiquement la pagination (max 10 pages = 1000 resultats).\nPour une gouv-source brute, ajouter `limit=100` dans l'URL ou utiliser gouv-query.\n\n### 4. Nommage des champs agrege\nApres une agregation dans gouv-query, les champs sont renommes :\n`\"champ__fonction\"` (double underscore). Exemple : `aggregate=\"population:sum\"` produit\nle champ `population__sum`. Utiliser ce nom dans `value-field` et `order-by`.\n\n### 5. Confusion syntaxe filtre generic vs ODSQL\n- **Mode generic** (gouv-query avec source) : `where=\"champ:operateur:valeur\"` (ex: `\"prix:gt:100\"`)\n- **Mode opendatasoft** (gouv-query serveur) : `where=\"prix > 100\"` (syntaxe SQL)\n- **Action reloadData** (builder-IA) : syntaxe ODSQL (SQL)\n- **Action createChart** (builder-IA) : syntaxe generic (`\"champ:operateur:valeur\"`)\nNe pas melanger les deux !\n\n### 6. Attributs HTML en kebab-case\nLes attributs HTML sont en kebab-case : `label-field`, `value-field`, `api-type`, `code-field`, etc.\nNe pas utiliser camelCase dans le HTML (`labelField` ne fonctionnera pas).\nEn revanche, les proprietes JavaScript sont en camelCase (`element.labelField`).\n\n### 8. La recherche ne filtre rien / cherche dans les mauvais champs\n- Verifier que `fields` liste les bons noms de champs (sensible a la casse)\n- Verifier que `source` pointe vers une source avec des donnees aplaties\n  (si Grist : s'assurer que flatten=\"fields\" est actif sur le normalize)\n- Si `fields` est vide, la recherche porte sur TOUS les champs, y compris\n  les champs techniques (id, SIRET...). Preciser les champs pour plus de precision.\n\n### 7. Facettes / datalist vides avec Grist ou ODS v1\nLes APIs Grist, ODS v1, et Airtable wrappent les donnees sous `records[].fields`.\nLes composants gouv-facets, gouv-datalist, gouv-query et gouv-kpi attendent des\ncles de premier niveau.\n\n**Solution** : ajouter `flatten=\"fields\"` sur gouv-normalize :\n```html\n<gouv-normalize id=\"clean\" source=\"raw\" flatten=\"fields\" trim></gouv-normalize>\n```"
  }
]